import time
import requests
from bs4 import BeautifulSoup

products = []
px_list = ['211.212.237.221:9812',
           '151.106.13.222:1080',
           '85.25.4.27:5566',
           '217.30.171.161:80',
           '185.24.233.208:80',
           '170.155.5.235:8080',
           '154.85.35.235:8888',
           '80.48.119.28:8080',
           '92.242.254.42:53545',
           '187.94.16.59:39665',
           '188.138.106.158:5566',
           '187.217.54.84:80',
           '66.29.154.105:3128',
           '8.213.129.196:80',
           '107.151.182.247:80',
           '152.32.190.229:80',
           '118.193.39.121:80',
           '61.255.239.33:8008',
           '192.140.42.81:47277',
           '177.129.253.133:3128',
           '85.25.196.218:5566',
           '103.177.45.10:80',
           '194.5.193.183:80',
           '153.122.107.129:80',
           '153.122.106.94:80',
           '93.158.214.155:3128',
           '93.158.214.153:3128',
           '93.158.214.154:3128',
           '18.140.166.66:8000',
           '197.149.247.82:8080',
           '103.73.194.2:80',
           '212.225.137.109:8080',
           '211.72.89.27:80',
           '195.80.49.3:80',
           '8.213.129.51:80',
           '195.80.49.254:80',
           '69.163.252.140:1081',
           '195.158.30.232:3128',
           '8.213.129.23:80',
           '41.65.236.43:1976',
           '154.236.184.80:1981',
           '8.213.128.253:80',
           '8.213.128.41:80',
           '198.11.173.185:80',
           '8.213.128.19:80',
           '8.213.128.114:80',
           '58.27.59.249:80',
           '181.205.41.210:7654',
           '85.25.150.32:5566',
           '110.78.138.125:8080',
           '142.44.148.56:8080',
           '117.54.114.97:80',
           '8.213.128.30:80',
           '64.227.62.123:80',
           '194.233.73.103:443',
           '194.233.73.106:443',
           '195.181.245.98:80',
           '185.233.37.83:80',
           '128.199.214.87:3128',
           '94.23.91.209:80',
           '169.57.1.85:8123',
           '164.132.137.241:80',
           '8.213.128.152:80',
           '103.177.146.1:30001',
           '154.236.177.101:1981',
           '47.74.152.29:8888',
           '103.155.217.156:41476',
           '8.213.129.34:80',
           '8.213.129.36:80',
           '93.158.214.164:3128',
           '93.158.214.163:3128',
           '93.158.214.162:3128',
           '133.130.91.24:3389',
           '195.80.49.253:80',
           '195.80.49.4:80',
           '52.28.211.251:3128',
           '151.106.17.122:1080',
           '103.174.4.114:8080',
           '41.65.181.132:8089',
           '197.255.209.34:8080',
           '186.96.50.39:999',
           '46.246.6.13:8888',
           '167.71.207.46:80',
           '14.52.134.171:8888',
           '201.217.49.2:80',
           '20.47.108.204:8888',
           '132.145.195.93:3128',
           '122.155.165.191:3128',
           '45.43.63.230:10001',
           '210.212.227.69:3128',
           '213.230.69.193:3128',
           '185.42.14.120:1081',
           '58.27.255.98:8080',
           '176.37.14.221:41890',
           '91.217.42.3:8080',
           '88.255.185.251:8080',
           '94.228.194.18:41890',
           '213.230.121.63:8080',
           '85.25.133.28:5566',
           '186.233.186.60:8080',
           '188.133.152.125:8080',
           '47.74.226.8:5001',
           '46.73.158.54:53281',
           '183.89.67.61:8080',
           '85.105.139.53:8090',
           '45.11.5.81:53281',
           '213.5.190.194:41890',
           '185.103.168.76:8080',
           '103.194.175.135:8080',
           '187.144.242.38:3128',
           '79.104.197.58:8080',
           '45.174.70.18:53281',
           '197.211.45.4:10000',
           '83.151.2.50:3128',
           '14.207.149.139:9080',
           '103.4.94.12:3128',
           '102.68.128.210:8080',
           '180.193.213.42:8080',
           '157.245.147.243:1081',
           '178.205.169.210:3128',
           '201.148.85.50:999',
           '159.224.243.185:37793',
           '109.235.189.217:8080',
           '190.128.225.117:999',
           '117.4.139.104:8080',
           '116.0.54.30:8080',
           '182.52.83.43:8080',
           '206.125.41.142:443',
           '191.97.17.55:999',
           '31.40.136.210:53281',
           '181.198.67.19:999',
           '8.213.128.171:80',
           '103.41.173.47:3128',
           '139.99.67.37:3128',
           '145.40.73.104:10019',
           '194.233.88.38:3128',
           '139.162.111.141:3128',
           '145.40.73.101:80',
           '178.184.215.101:8080',
           '102.40.15.47:1981',
           '189.165.58.39:10101',
           '45.80.149.36:23456',
           '37.48.82.75:3128',
           '213.230.71.230:8080',
           '95.181.135.34:8080',
           '119.76.142.172:8080',
           '180.183.15.198:8080',
           '14.207.121.235:8080',
           '46.219.80.142:57401',
           '51.79.50.22:9300',
           '152.231.25.126:8080',
           '110.232.66.209:808',
           '103.100.84.20:8080',
           '103.70.79.2:8080',
           '51.38.191.151:80',
           '85.25.201.22:5566',
           '162.214.202.170:80',
           '151.106.17.123:1080',
           '117.54.114.101:80',
           '118.193.40.245:80',
           '103.65.212.150:8085',
           '202.75.97.82:47009',
           '1.162.40.85:8080',
           '175.100.72.95:57938',
           '66.29.154.103:3128',
           '194.67.91.153:80',
           '43.255.113.232:8082',
           '103.97.200.52:80',
           '139.255.74.125:8080',
           '122.15.131.65:57873',
           '35.178.124.1:8888',
           '196.1.95.117:80',
           '51.68.82.156:8118',
           '194.233.69.90:443',
           '151.106.17.126:1080',
           '103.122.32.10:8080',
           '14.170.154.193:19132',
           '95.216.12.141:22207',
           '116.80.41.12:80',
           '212.46.255.78:8080',
           '113.176.88.14:8080',
           '76.118.227.8:8080',
           '117.54.114.102:80',
           '151.106.18.123:1080',
           '103.177.45.11:80',
           '118.193.35.175:80',
           '75.119.197.10:1081',
           '8.213.128.131:80',
           '8.213.128.158:80',
           '117.54.114.103:80',
           '118.193.39.226:80',
           '194.233.69.41:443',
           '89.237.34.193:37647',
           '212.73.73.234:8081',
           '103.125.172.9:1080',
           '103.215.207.74:83',
           '203.150.128.51:8080',
           '103.11.106.38:8181',
           '93.113.233.73:3128',
           '62.33.8.148:8081',
           '103.177.45.7:80',
           '91.150.189.122:30389',
           '194.233.73.108:443',
           '8.213.128.214:80',
           '8.213.129.57:80',
           '3.120.173.144:8080',
           '8.213.128.149:80',
           '110.74.195.34:25',
           '8.213.128.172:80',
           '118.193.40.59:80',
           '85.25.195.177:5566',
           '85.25.72.91:5566',
           '173.82.149.243:8080',
           '201.120.27.15:53281',
           '194.233.69.126:443',
           '188.138.89.29:5566',
           '151.106.18.124:1080',
           '85.25.91.156:5566',
           '8.210.83.33:80',
           '152.32.214.121:80',
           '151.106.13.219:1080',
           '195.158.18.236:3128',
           '207.244.242.103:9090',
           '151.106.17.125:1080',
           '192.241.158.51:1081',
           '80.76.60.2:3128',
           '65.108.215.105:3128',
           '154.72.195.126:9090',
           '172.105.124.247:3128',
           '103.111.59.14:8080',
           '185.56.209.114:52342',
           '93.240.114.68:4003',
           '109.60.137.186:8080',
           '213.226.11.149:41878',
           '66.94.97.238:443',
           '202.154.180.53:46717',
           '114.6.227.28:8080',
           '121.101.131.10:8080',
           '180.178.190.70:8080',
           '46.101.49.62:80',
           '103.162.205.252:8181',
           '104.168.77.133:3128',
           '190.2.210.249:999',
           '154.236.184.71:1981',
           '85.25.132.9:5566',
           '13.126.88.39:80',
           '103.156.128.245:8080',
           '168.83.78.195:80',
           '62.75.229.165:5566',
           '85.25.208.198:5566',
           '61.29.96.146:80',
           '101.255.127.11:8080',
           '114.5.199.194:8182',
           '178.217.172.206:55443',
           '14.139.207.116:80',
           '128.199.202.122:3128',
           '173.249.57.9:443',
           '41.87.64.210:8080',
           '105.213.93.195:55443',
           '8.214.41.50:80',
           '151.106.18.126:1080',
           '38.101.122.186:999',
           '85.25.242.142:5566',
           '89.248.174.40:8118',
           '203.110.240.156:80',
           '103.228.246.37:3127',
           '151.106.18.125:1080',
           '93.188.161.84:80',
           '62.75.236.132:5566',
           '151.106.18.122:1080',
           '212.46.230.102:6969',
           '85.25.246.206:5566',
           '51.79.197.203:3128',
           '85.172.19.214:8080',
           '8.213.128.127:80',
           '103.145.45.57:55443',
           '203.153.198.4:8080',
           '124.158.175.26:8080',
           '85.25.119.113:5566',
           '85.25.155.103:5566',
           '194.233.69.38:443',
           '103.134.255.113:80',
           '118.193.34.51:80',
           '85.25.235.229:5566',
           '149.5.36.2:8080',
           '46.219.8.201:41890',
           '204.195.136.34:80',
           '110.77.134.106:8080',
           '103.137.84.18:84',
           '103.153.232.254:8080',
           '197.221.158.186:8080',
           '5.189.229.42:1081',
           '85.25.235.82:5566',
           '85.25.196.76:5566',
           '189.63.232.244:3128',
           '188.138.89.50:5566',
           '118.193.34.17:80',
           '95.142.99.250:8888',
           '223.171.84.181:8000',
           '51.75.206.209:80']
file = './links.txt'
with open(file, 'r') as f:
    urls = f.readlines()

px_idx = 0
proxy = None if px_list is None else px_list[px_idx]

for url in urls:
    try:
        response = requests.get(url, proxies={
            "http": proxy, "https": proxy}, timeout=180)
    except:
        if px_idx == len(px_list) - 1:
            px_idx = 0
        else:
            px_idx += 1
        proxy = px_list[px_idx]
        continue
    print(url)
    data = {'category': [], 'type':[],'name': [], 'brand': [],
            'desc':[],'img_link': []}

    html = response.text
    soup = BeautifulSoup(url)
    try:
        data['name'] = soup.find('span', {'data-at': 'product_name'}).text
        data['category'] = soup.find('a', {'data-at': 'pdp_bread_crumb'}).text
        data['brand'] = soup.find('a', {'data-at': 'brand_name'}).text
        data['img_link'] = soup.find('img', {'alt data-comp': 'Image StyledComponent BaseComponent'}).src
    except:  # page does not exist
        pass
    # purpose of product
    try:
        desc = soup.select_one('body > div:nth-child(3) > main > div:nth-child(1) > div.css-1kcruh2.eanm77i0 > div:nth-child(2) > div > div').text
    except:  # no description
        pass
    print(data)
    products.append(data)
    time.sleep(10)

products.to_csv('./crawler_output.csv', sep=';', encoding='cp1252')
